<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Teste Supabase - CodeGen Studio</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/module.js" type="module"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        h1 {
            color: #00d9ff;
            margin-bottom: 30px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            border-color: #00d9ff;
            background: #222;
        }
        
        .card h2 {
            color: #00d9ff;
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            background: #00d9ff;
            color: #000;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        
        button:hover {
            background: #00b8cc;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        input {
            width: 100%;
            padding: 10px;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #e0e0e0;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        input:focus {
            outline: none;
            border-color: #00d9ff;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.2);
        }
        
        .output {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 12px;
            margin-top: 10px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            color: #00d9ff;
        }
        
        .output.success {
            border-color: #00cc00;
            color: #00cc00;
        }
        
        .output.error {
            border-color: #ff3333;
            color: #ff6666;
        }
        
        .output.warning {
            border-color: #ffaa00;
            color: #ffdd00;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff3333;
        }
        
        .status-indicator.connected {
            background: #00cc00;
        }
        
        .divider {
            height: 1px;
            background: #333;
            margin: 30px 0;
        }
        
        .success { color: #00cc00; }
        .error { color: #ff6666; }
        .warning { color: #ffdd00; }
        .info { color: #00d9ff; }
        
        .all-tests {
            grid-column: 1 / -1;
        }
        
        .code-block {
            background: #0a0a0a;
            border-left: 3px solid #00d9ff;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
        }
        
        .instructions {
            background: #1a1a1a;
            border: 1px solid #00d9ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            color: #e0e0e0;
        }
        
        .instructions h3 {
            color: #00d9ff;
            margin-bottom: 10px;
        }
        
        .instructions ol {
            margin-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Teste Supabase - CodeGen Studio</h1>
        
        <div class="instructions">
            <h3>üìã Instru√ß√µes</h3>
            <ol>
                <li>Execute os testes na ordem indicada</li>
                <li>Anote os erros para diagn√≥stico</li>
                <li>Se todos os testes passarem, o Supabase est√° configurado corretamente</li>
                <li>Se alguns falharem, verifique as credenciais e o esquema do banco de dados</li>
            </ol>
        </div>
        
        <div id="status" class="status">
            <div class="status-indicator"></div>
            <span>Carregando...</span>
        </div>
        
        <div class="grid">
            <!-- Teste 1: Conex√£o -->
            <div class="card">
                <h2>1Ô∏è‚É£ Conex√£o</h2>
                <button onclick="testConnection()">Testar Conex√£o</button>
                <div id="output1" class="output"></div>
            </div>
            
            <!-- Teste 2: Autentica√ß√£o -->
            <div class="card">
                <h2>2Ô∏è‚É£ Autentica√ß√£o</h2>
                <button onclick="testAuth()">Verificar Sess√£o</button>
                <div id="output2" class="output"></div>
            </div>
            
            <!-- Teste 3: Tabelas -->
            <div class="card">
                <h2>3Ô∏è‚É£ Tabelas</h2>
                <button onclick="testTables()">Testar Tabelas</button>
                <div id="output3" class="output"></div>
            </div>
            
            <!-- Teste 4: Login -->
            <div class="card">
                <h2>4Ô∏è‚É£ Login</h2>
                <input type="email" id="loginEmail" placeholder="Email">
                <input type="password" id="loginPassword" placeholder="Senha">
                <button onclick="testLogin()">Tentar Login</button>
                <div id="output4" class="output"></div>
            </div>
            
            <!-- Teste 5: Salvar Projeto -->
            <div class="card">
                <h2>5Ô∏è‚É£ Salvar Projeto</h2>
                <input type="text" id="projectName" placeholder="Nome do projeto" value="TestProject">
                <button onclick="testSaveProject()">Salvar Projeto</button>
                <div id="output5" class="output"></div>
            </div>
            
            <!-- Teste 6: Listar Projetos -->
            <div class="card">
                <h2>6Ô∏è‚É£ Listar Projetos</h2>
                <button onclick="testListProjects()">Listar Meus Projetos</button>
                <div id="output6" class="output"></div>
            </div>
            
            <!-- Todos os Testes -->
            <div class="card all-tests">
                <h2>üöÄ Executar Todos os Testes</h2>
                <button onclick="runAllTests()" style="background: #00cc00;">Executar Diagn√≥stico Completo</button>
                <div id="outputAll" class="output"></div>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="instructions">
            <h3>üîß Comandos de Console</h3>
            <p>Voc√™ tamb√©m pode usar os seguintes comandos no console do navegador (F12):</p>
            <div class="code-block">
// No console do navegador (F12):
debugService.runAllTests()
debugService.testConnection()
debugService.testAuth()
debugService.testLogin('email@example.com', 'senha123')
debugService.testSaveProject('MeuProjeto')
debugService.testListProjects()
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/+esm';

        const supabaseUrl = 'https://oggabkywjtcghojhzepn.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9nZ2Fia3l3anRjZ2hvamh6ZXBuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxNjIwNjIsImV4cCI6MjA3MTczODA2Mn0.x2eABhTnCuYMzLfl0Jzmn_BtXANW08rXlniikaLVsvU';

        const supabase = createClient(supabaseUrl, supabaseAnonKey);
        
        window.supabase = supabase;

        // Fun√ß√µes de teste
        window.testConnection = async function() {
            const output = document.getElementById('output1');
            try {
                const { data, error } = await supabase.auth.getSession();
                if (error) throw error;
                
                output.textContent = `‚úÖ Conectado com sucesso!\nüìç URL: ${supabaseUrl}`;
                output.className = 'output success';
                updateStatus(true);
            } catch (err) {
                output.textContent = `‚ùå Erro: ${err.message}`;
                output.className = 'output error';
                updateStatus(false);
            }
        };

        window.testAuth = async function() {
            const output = document.getElementById('output2');
            try {
                const { data: { session } } = await supabase.auth.getSession();
                
                if (session) {
                    output.textContent = `‚úÖ Autenticado!\nüìç User: ${session.user.email}\nüìç ID: ${session.user.id}`;
                    output.className = 'output success';
                } else {
                    output.textContent = '‚ö†Ô∏è N√£o autenticado';
                    output.className = 'output warning';
                }
            } catch (err) {
                output.textContent = `‚ùå Erro: ${err.message}`;
                output.className = 'output error';
            }
        };

        window.testTables = async function() {
            const output = document.getElementById('output3');
            try {
                const { error: e1 } = await supabase.from('profiles').select('count').limit(1);
                const { error: e2 } = await supabase.from('projects').select('count').limit(1);
                
                if (e1 || e2) {
                    output.textContent = `‚ùå Erro ao acessar tabelas\nprofiles: ${e1?.message || '‚úÖ'}\nprojects: ${e2?.message || '‚úÖ'}`;
                    output.className = 'output error';
                } else {
                    output.textContent = '‚úÖ Ambas as tabelas est√£o acess√≠veis';
                    output.className = 'output success';
                }
            } catch (err) {
                output.textContent = `‚ùå Erro: ${err.message}`;
                output.className = 'output error';
            }
        };

        window.testLogin = async function() {
            const output = document.getElementById('output4');
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                output.textContent = '‚ö†Ô∏è Preencha email e senha';
                output.className = 'output warning';
                return;
            }
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                
                if (error) throw error;
                
                output.textContent = `‚úÖ Login bem-sucedido!\nüìç Email: ${data.user.email}\nüìç ID: ${data.user.id}`;
                output.className = 'output success';
                updateStatus(true);
            } catch (err) {
                output.textContent = `‚ùå Erro: ${err.message}`;
                output.className = 'output error';
            }
        };

        window.testSaveProject = async function() {
            const output = document.getElementById('output5');
            const { data: { session } } = await supabase.auth.getSession();
            
            if (!session) {
                output.textContent = '‚ùå Fa√ßa login primeiro';
                output.className = 'output error';
                return;
            }
            
            const projectName = document.getElementById('projectName').value || 'TestProject';
            
            try {
                const { data, error } = await supabase
                    .from('projects')
                    .insert({
                        name: projectName,
                        files: [],
                        chat_history: [],
                        env_vars: {}
                    })
                    .select()
                    .single();
                
                if (error) throw error;
                
                output.textContent = `‚úÖ Projeto salvo!\nüìç ID: ${data.id}\nüìç Nome: ${data.name}`;
                output.className = 'output success';
            } catch (err) {
                output.textContent = `‚ùå Erro: ${err.message}\nüìã C√≥digo: ${err.code}`;
                output.className = 'output error';
            }
        };

        window.testListProjects = async function() {
            const output = document.getElementById('output6');
            const { data: { session } } = await supabase.auth.getSession();
            
            if (!session) {
                output.textContent = '‚ùå Fa√ßa login primeiro';
                output.className = 'output error';
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('projects')
                    .select('*')
                    .eq('user_id', session.user.id);
                
                if (error) throw error;
                
                output.textContent = `‚úÖ ${data.length} projeto(s) encontrado(s)\n${data.map(p => `üìã ${p.name} (ID: ${p.id})`).join('\n')}`;
                output.className = 'output success';
            } catch (err) {
                output.textContent = `‚ùå Erro: ${err.message}`;
                output.className = 'output error';
            }
        };

        window.runAllTests = async function() {
            const output = document.getElementById('outputAll');
            output.textContent = '‚è≥ Executando todos os testes...\n';
            output.className = 'output warning';
            
            document.getElementById('output1').textContent = '‚è≥ Testando...';
            await testConnection();
            
            document.getElementById('output2').textContent = '‚è≥ Testando...';
            await testAuth();
            
            document.getElementById('output3').textContent = '‚è≥ Testando...';
            await testTables();
            
            document.getElementById('output6').textContent = '‚è≥ Testando...';
            await testListProjects();
            
            output.textContent = '‚úÖ Testes completos!\nVerifique os resultados acima.';
            output.className = 'output success';
        };

        function updateStatus(connected) {
            const status = document.querySelector('.status');
            const indicator = document.querySelector('.status-indicator');
            const text = status.querySelector('span');
            
            if (connected) {
                indicator.className = 'status-indicator connected';
                text.textContent = '‚úÖ Supabase conectado';
                text.style.color = '#00cc00';
            } else {
                indicator.className = 'status-indicator';
                text.textContent = '‚ùå Supabase desconectado';
                text.style.color = '#ff6666';
            }
        }

        // Testes iniciais ao carregar
        setTimeout(() => {
            testConnection();
        }, 1000);
    </script>
</body>
</html>